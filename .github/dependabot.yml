# Dependabot configuration for vulnerable-node demo
# Uses multi-ecosystem-groups to consolidate PRs across directories & ecosystems
# If the same vulnerable package exists in root + subdirectories, ONE PR fixes all

version: 2

multi-ecosystem-groups:
  # All Node.js dependencies across root + all subdirectories in one PR
  all-node-deps:
    schedule:
      interval: "daily"
    labels: ["dependencies", "npm"]
    commit-message:
      prefix: "deps"
      include: "scope"

  # All Python dependencies grouped together
  all-python-deps:
    schedule:
      interval: "daily"
    labels: ["dependencies", "python"]
    commit-message:
      prefix: "deps"
      include: "scope"

  # All Docker updates grouped together
  all-docker:
    schedule:
      interval: "weekly"
    labels: ["dependencies", "docker"]

updates:
  # Root npm - part of the all-node-deps multi-ecosystem group
  - package-ecosystem: "npm"
    directory: "/"
    patterns: ["*"]
    multi-ecosystem-group: "all-node-deps"

  # API microservice npm - same group, so shared packages get ONE PR
  - package-ecosystem: "npm"
    directory: "/services/api"
    patterns: ["*"]
    multi-ecosystem-group: "all-node-deps"

  # Frontend service npm - same group
  - package-ecosystem: "npm"
    directory: "/services/frontend"
    patterns: ["*"]
    multi-ecosystem-group: "all-node-deps"

  # Build tools npm - same group
  - package-ecosystem: "npm"
    directory: "/tools/scripts"
    patterns: ["*"]
    multi-ecosystem-group: "all-node-deps"

  # Python requirements - grouped together
  - package-ecosystem: "pip"
    directory: "/tools/scripts"
    patterns: ["*"]
    multi-ecosystem-group: "all-python-deps"

  # Docker root
  - package-ecosystem: "docker"
    directory: "/"
    patterns: ["*"]
    multi-ecosystem-group: "all-docker"

  # Docker postgresql service
  - package-ecosystem: "docker"
    directory: "/services/postgresql"
    patterns: ["*"]
    multi-ecosystem-group: "all-docker"
